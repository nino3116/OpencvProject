{% extends "cam/base.html" %} {%block title%}Camera ê´€ë¦¬{%endblock%} {% block
content %}
<body class="container mt-4">
  <h2 class="mb-4">ğŸ“· Camera ê´€ë¦¬ ì‹œìŠ¤í…œ</h2>
  {#
  <form id="addForm" class="mb-4">
    <div class="row">
      <div class="col">
        <input
          type="text"
          id="cam_name"
          class="form-control"
          placeholder="ì¹´ë©”ë¼ ì´ë¦„"
          required
        />
      </div>
      <div class="col">
        <input
          type="text"
          id="cam_group"
          class="form-control"
          placeholder="ì¹´ë©”ë¼ ê·¸ë£¹"
        />
      </div>
      <div class="col">
        <input
          type="number"
          id="num_person"
          class="form-control"
          placeholder="ê°ì§€ ì¸ì› ìˆ˜"
        />
      </div>
      #}
      <div class="col">
        <a href="{{url_for('cam.add_camera')}}" class="btn btn-primary">ì¶”ê°€</a>
      </div>
    </div>
  </form>

  <table class="table table-bordered">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>ì¹´ë©”ë¼ ì´ë¦„</th>
        <th>ê·¸ë£¹</th>
        <th>ì˜ìƒì„œë²„ ì£¼ì†Œ</th>
        <th>ì‚­ì œ</th>
      </tr>
    </thead>
    <tbody id="cameraTable">
      {% for camera in cam %}
      <tr>
        <td>{{ camera.id }}</td>
        <td contenteditable="true" onBlur="updateCam({{ cam.id }}, this)">
          {{ camera.name }}
        </td>
        <td contenteditable="true" onBlur="updateCam({{ cam.id }}, this)">
          {{ camera.group }}
        </td>
        <td contenteditable="true" onBlur="updateCam({{ cam.id }}, this)">
          {{ camera.url }}
        </td>
        <td>
          <button
            class="btn btn-danger btn-sm"
            onclick="deleteCam({{ camera.id }})"
          >
            ì‚­ì œ
          </button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <script>
    $("#addForm").submit(function (e) {
      e.preventDefault();
      let data = {
        name: $("#name").val(),
        group: $("#group").val(),
        url: $("#url").val(),
      };
      $.ajax({
        url: "/add",
        type: "POST",
        contentType: "application/json", // JSON í˜•ì‹ìœ¼ë¡œ ì „ì†¡
        data: JSON.stringify(data),
        success: function (response) {
          location.reload();
        },
        error: function (xhr, status, error) {
          console.error("ì¶”ê°€ ì‹¤íŒ¨ : ", error);
        },
      });
    });

    function updateCam(id, element) {
      let column = ["name", "group", "url"][element.cellIndex - 1];
      let oldValue = element.getAttribute("data-old_value");
      let newValue = element.innerText.trim();

      if (oldValue === newValue) return;

      let data = { [column]: newValue };
      element.setAttribute("data-old_value", newValue);

      $.post(
        `/update/${id}`,
        JSON.stringify(data),
        function () {
          confirm("ìˆ˜ì • ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.");
          console.log("íŒì—… ë‹«í˜");
        },
        "json"
      );
    }

    function deleteCam(id) {
      if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        $.post(`/delete/${id}`, function () {
          location.reload();
        });
      }
    }
  </script>
  {% endblock %}
</body>
